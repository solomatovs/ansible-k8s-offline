# Toolchain для Go 1.4.
# Go 1.4 не определяет GOROOT автоматически, поэтому задаём явно.
# GOPATH нужен для workspace-модели (до появления модулей).

ARG BASE_IMAGE=astra-linux:2.12
ARG GOLANG_IMAGE

FROM ${GOLANG_IMAGE} AS golang-build

FROM ${BASE_IMAGE}

ENV DEBIAN_FRONTEND=noninteractive

# Build-инструменты для CGO и Go-проектов
RUN apt-get update \
 && apt-get install -y --no-install-recommends \
        gcc \
        libc6-dev \
        make \
        pkg-config \
        git \
 && rm -rf /var/lib/apt/lists/*

# Go компилятор из golang-проекта
COPY --from=golang-build /out/usr/local/go /usr/local/go

ENV GOROOT=/usr/local/go \
    GOPATH=/go \
    PATH="/usr/local/go/bin:/go/bin:${PATH}"
