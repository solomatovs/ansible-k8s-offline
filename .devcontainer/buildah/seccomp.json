{
  "defaultAction": "SCMP_ACT_ERRNO",
  "defaultErrnoRet": 38,
  "archMap": [
    { "architecture": "SCMP_ARCH_X86_64", "subArchitectures": ["SCMP_ARCH_X86", "SCMP_ARCH_X32"] },
    { "architecture": "SCMP_ARCH_AARCH64", "subArchitectures": ["SCMP_ARCH_ARM"] }
  ],
  "syscalls": [
    {
      "comment": "Base allowlist: file/process/network/memory/signal/IPC syscalls needed for buildah, apt/dpkg, and general container operation. Based on Docker default profile with unnecessary syscalls moved to DISABLED section below",
      "names": [
        "accept", "accept4", "access", "alarm", "bind", "brk",
        "capget", "capset", "chdir", "chmod", "chown", "chown32", "chroot",
        "clock_getres", "clock_getres_time64",
        "clock_gettime", "clock_gettime64", "clock_nanosleep", "clock_nanosleep_time64",
        "clone", "clone3", "close", "close_range", "connect", "copy_file_range",
        "creat", "dup", "dup2", "dup3", "epoll_create", "epoll_create1",
        "epoll_ctl", "epoll_ctl_old", "epoll_pwait", "epoll_pwait2", "epoll_wait",
        "epoll_wait_old", "eventfd", "eventfd2", "execve", "execveat", "exit",
        "exit_group", "faccessat", "faccessat2", "fadvise64", "fadvise64_64",
        "fallocate", "fchdir", "fchmod", "fchmodat", "fchmodat2",
        "fchown", "fchown32", "fchownat", "fcntl", "fcntl64", "fdatasync",
        "fgetxattr", "flistxattr", "flock", "fork", "fremovexattr", "fsetxattr",
        "fstat", "fstat64", "fstatat64", "fstatfs", "fstatfs64", "fsync",
        "ftruncate", "ftruncate64", "futex", "futex_time64", "futex_waitv",
        "getcpu", "getcwd", "getdents", "getdents64", "getegid", "getegid32",
        "geteuid", "geteuid32", "getgid", "getgid32", "getgroups", "getgroups32",
        "getitimer", "getpeername", "getpgid", "getpgrp", "getpid", "getppid",
        "getpriority", "getrandom", "getresgid", "getresgid32", "getresuid",
        "getresuid32", "getrlimit", "get_robust_list", "getrusage", "getsid",
        "getsockname", "getsockopt", "get_thread_area", "gettid", "gettimeofday",
        "getuid", "getuid32", "getxattr", "inotify_add_watch", "inotify_init",
        "inotify_init1", "inotify_rm_watch", "io_cancel", "ioctl", "io_destroy",
        "io_getevents", "io_pgetevents", "io_pgetevents_time64", "ioprio_get",
        "ioprio_set", "io_setup", "io_submit",
        "ipc", "kill",
        "landlock_add_rule", "landlock_create_ruleset",
        "landlock_restrict_self", "lchown", "lchown32", "lgetxattr", "link",
        "linkat", "listen", "listxattr", "llistxattr", "lremovexattr", "lseek",
        "lsetxattr", "lstat", "lstat64", "madvise", "membarrier", "memfd_create",
        "memfd_secret", "mincore", "mkdir", "mkdirat", "mknod", "mknodat",
        "mlock", "mlock2", "mlockall", "mmap", "mmap2", "mprotect",
        "mremap",
        "msgctl", "msgget", "msgrcv", "msgsnd", "msync", "munlock", "munlockall", "munmap",
        "nanosleep", "newfstatat", "_newselect", "open", "openat", "openat2",
        "pause", "pidfd_open", "pidfd_send_signal", "pipe", "pipe2", "poll",
        "ppoll", "ppoll_time64", "prctl", "pread64", "preadv", "preadv2",
        "prlimit64", "pselect6", "pselect6_time64",
        "pwrite64", "pwritev", "pwritev2", "read", "readahead", "readlink",
        "readlinkat", "readv", "recv", "recvfrom", "recvmmsg", "recvmmsg_time64",
        "recvmsg", "remap_file_pages", "removexattr", "rename", "renameat",
        "renameat2", "restart_syscall", "rmdir", "rseq", "rt_sigaction",
        "rt_sigpending", "rt_sigprocmask", "rt_sigqueueinfo", "rt_sigreturn",
        "rt_sigsuspend", "rt_sigtimedwait", "rt_sigtimedwait_time64",
        "rt_tgsigqueueinfo", "sched_getaffinity", "sched_getattr", "sched_getparam",
        "sched_get_priority_max", "sched_get_priority_min", "sched_getscheduler",
        "sched_setaffinity", "sched_setattr", "sched_setparam", "sched_setscheduler",
        "sched_yield", "seccomp", "select", "semctl", "semget", "semop",
        "semtimedop", "semtimedop_time64", "send", "sendfile", "sendfile64",
        "sendmmsg", "sendmsg", "sendto", "setfsgid", "setfsgid32", "setfsuid",
        "setfsuid32", "setgid", "setgid32", "setgroups", "setgroups32",
        "setitimer", "setpgid", "setpriority", "setregid", "setregid32",
        "setresgid", "setresgid32", "setresuid", "setresuid32", "setreuid",
        "setreuid32", "setrlimit", "set_robust_list", "setsid", "setsockopt",
        "set_thread_area", "set_tid_address", "setuid", "setuid32", "setxattr",
        "shmat", "shmctl", "shmdt", "shmget", "shutdown", "sigaltstack",
        "signalfd", "signalfd4", "sigprocmask", "sigreturn", "socket",
        "socketcall", "socketpair", "splice", "stat", "stat64", "statfs",
        "statfs64", "statx", "symlink", "symlinkat", "sync", "sync_file_range",
        "syncfs", "sysinfo", "tee", "tgkill", "time", "timer_create",
        "timer_delete", "timer_getoverrun", "timer_gettime", "timer_gettime64",
        "timerfd_create", "timerfd_gettime", "timerfd_gettime64", "timerfd_settime",
        "timerfd_settime64", "timer_settime", "timer_settime64", "times",
        "tkill", "truncate", "truncate64", "ugetrlimit", "umask", "uname",
        "unlink", "unlinkat", "utime", "utimensat", "utimensat_time64",
        "utimes", "vfork", "vmsplice", "wait4", "waitid", "waitpid", "write",
        "writev"
      ],
      "action": "SCMP_ACT_ALLOW"
    },
    {
      "comment": "buildah: mount/umount needed for chroot isolation — bind-mounts /proc, /dev, /sys, /etc/resolv.conf inside chroot even with BUILDAH_ISOLATION=chroot",
      "names": ["mount", "umount", "umount2"],
      "action": "SCMP_ACT_ALLOW"
    },
    {
      "comment": "buildah: unshare creates user namespace for UID/GID mapping via newuidmap/newgidmap (reads /etc/subuid, /etc/subgid)",
      "names": ["unshare"],
      "action": "SCMP_ACT_ALLOW"
    },
    {
      "comment": "Docker default: personality(0) — reset execution domain to default. Needed by execve in some glibc versions",
      "names": ["personality"],
      "action": "SCMP_ACT_ALLOW",
      "args": [
        { "index": 0, "value": 0, "op": "SCMP_CMP_EQ" }
      ]
    },
    {
      "comment": "Docker default: personality PER_LINUX32 (0x20000) — 32-bit compatibility mode for x86 binaries on x86_64",
      "names": ["personality"],
      "action": "SCMP_ACT_ALLOW",
      "args": [
        { "index": 0, "value": 131072, "op": "SCMP_CMP_EQ" }
      ]
    },
    {
      "comment": "Docker default: personality PER_LINUX (0xffffffff) — query current personality without changing it",
      "names": ["personality"],
      "action": "SCMP_ACT_ALLOW",
      "args": [
        { "index": 0, "value": 4294967295, "op": "SCMP_CMP_EQ" }
      ]
    },
    {
      "comment": "Docker default: arch_prctl — set/get FS/GS segment base for TLS (thread-local storage). Required on x86_64, every threaded program uses it",
      "names": ["arch_prctl"],
      "action": "SCMP_ACT_ALLOW"
    },
    {
      "comment": "Docker default: clone with CLONE_NEWNS mask (0x7E020000) — allows namespace creation flags, used by buildah for mount/user/pid namespaces",
      "names": ["clone"],
      "action": "SCMP_ACT_ALLOW",
      "args": [
        { "index": 0, "value": 2114060288, "op": "SCMP_CMP_MASKED_EQ" }
      ]
    },
    {
      "comment": "Docker default: clone3 returns ENOSYS (38) — forces glibc to fallback to clone(2) which has proper seccomp arg filtering above",
      "names": ["clone3"],
      "action": "SCMP_ACT_ERRNO",
      "errnoRet": 38
    },

    {
      "comment": "DISABLED: ptrace — process tracing for strace/gdb. Major attack surface: allows reading process memory, injecting code, bypassing security checks. Not needed for image builds. To re-enable: change action to SCMP_ACT_ALLOW and add --cap-add SYS_PTRACE to devcontainer.json runArgs",
      "names": ["ptrace"],
      "action": "SCMP_ACT_ERRNO",
      "errnoRet": 1
    },
    {
      "comment": "DISABLED: modify_ldt — x86 Local Descriptor Table modification for legacy 32-bit threading (NPTL replaced this). Not needed on modern amd64/arm64",
      "names": ["modify_ldt"],
      "action": "SCMP_ACT_ERRNO",
      "errnoRet": 1
    },
    {
      "comment": "DISABLED: personality UNAME26 (value=8) — obsolete flag that fakes kernel version as 2.6.x in uname(). No modern software depends on this",
      "names": ["personality"],
      "action": "SCMP_ACT_ERRNO",
      "errnoRet": 1,
      "args": [
        { "index": 0, "value": 8, "op": "SCMP_CMP_EQ" }
      ]
    },
    {
      "comment": "DISABLED: personality PER_LINUX32|UNAME26 (value=131080) — combination of 32-bit mode with obsolete UNAME26 flag",
      "names": ["personality"],
      "action": "SCMP_ACT_ERRNO",
      "errnoRet": 1,
      "args": [
        { "index": 0, "value": 131080, "op": "SCMP_CMP_EQ" }
      ]
    },
    {
      "comment": "DISABLED: adjtimex, clock_adjtime — adjust system/hardware clock. Image builds never need to modify system time. Removes unnecessary privilege",
      "names": ["adjtimex", "clock_adjtime", "clock_adjtime64"],
      "action": "SCMP_ACT_ERRNO",
      "errnoRet": 1
    },
    {
      "comment": "DISABLED: io_uring — modern async I/O subsystem (kernel 5.1+). buildah/apt/dpkg use standard epoll/poll. io_uring has had multiple kernel CVEs (CVE-2021-41073, CVE-2023-2598) and adds unnecessary attack surface",
      "names": ["io_uring_enter", "io_uring_register", "io_uring_setup"],
      "action": "SCMP_ACT_ERRNO",
      "errnoRet": 1
    },
    {
      "comment": "DISABLED: POSIX message queues (mq_*) — IPC mechanism for inter-process messaging. Neither buildah nor apt/dpkg use POSIX MQ. SysV IPC (msgctl/msgget/semctl/shmctl) is kept in the allowlist because dpkg may use it",
      "names": ["mq_getsetattr", "mq_notify", "mq_open", "mq_timedreceive", "mq_timedreceive_time64", "mq_timedsend", "mq_timedsend_time64", "mq_unlink"],
      "action": "SCMP_ACT_ERRNO",
      "errnoRet": 1
    },
    {
      "comment": "DISABLED: fanotify_mark — filesystem-wide event monitoring used by antivirus/audit daemons. NOT the same as inotify (which IS allowed for file watching). buildah does not need filesystem-wide monitoring",
      "names": ["fanotify_mark"],
      "action": "SCMP_ACT_ERRNO",
      "errnoRet": 1
    },
    {
      "comment": "DISABLED: process_mrelease — release memory of a dying process (OOM-killer optimization, kernel 5.14+). Not relevant for build workloads",
      "names": ["process_mrelease"],
      "action": "SCMP_ACT_ERRNO",
      "errnoRet": 1
    }
  ]
}
