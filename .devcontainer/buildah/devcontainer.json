{
  "name": "buildah-rootless",

  "build": {
    "dockerfile": "${localWorkspaceFolder}/buildah/Dockerfile",
    "context": "${localWorkspaceFolder}/buildah"
  },

  "mounts": [
    // claude code config
    "source=${localEnv:HOME}/.claude,target=/root/.claude,type=bind",
    // passwd, group, subuid, subgid
    "source=${localWorkspaceFolder}/.devcontainer/buildah/passwd,target=/etc/passwd,type=bind",
    "source=${localWorkspaceFolder}/.devcontainer/buildah/group,target=/etc/group,type=bind",
    "source=${localWorkspaceFolder}/.devcontainer/buildah/subuid,target=/etc/subuid,type=bind",
    "source=${localWorkspaceFolder}/.devcontainer/buildah/subgid,target=/etc/subgid,type=bind",
    // buildah image storage — именованный том, переживает пересоздание контейнера
    "source=buildah-storage,target=/home/.local/share/containers,type=volume",
    // артефакты сборки (исходники и выходные бинарники)
    "source=artifacts,target=/home/.local/artifacts,type=volume"
  ],
  "containerUser": "1001:1001",
  "updateRemoteUserUID": false,

  "runArgs": [
    // DISABLED: CAP_SYS_PTRACE — only needed for debugging (strace/gdb).
    // Re-enable together with ptrace syscall in seccomp.json if debugging is needed
    // "--cap-add",
    // "SYS_PTRACE",
    "--security-opt",
    "seccomp=.devcontainer/buildah/seccomp.json"
  ],

  "hostRequirements": {
    "cpus": 1,
    "memory": "4gb",
    "storage": "4gb"
  },

  "customizations": {
    "vscode": {
      "settings": {
        "terminal.integrated.defaultProfile.linux": "bash",
        "terminal.integrated.profiles.linux": {
          "sh": {
            "path": "/bin/bash",
            "args": ["-l"]
          }
        }
      },
      "extensions": ["dracula-theme.theme-dracula", "Anthropic.claude-code"]
    }
  }
}
